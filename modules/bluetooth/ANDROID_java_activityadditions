
native void scanEvent(List<ScanResult> resultList);

private ScanCallback scanCallback;

public void startScan(){
  System.out.println("LOGIT : Starting Scan");
  List<ScanResult> scanResults = new ArrayList<>();

  scanCallback = new ScanCallback() {
      @Override
      public void onScanResult(int callbackType, ScanResult result) {
          super.onScanResult(callbackType, result);
          String macAddress = result.getDevice().getAddress();
          int rssi = result.getRssi();
          if(rssi < -70)
            return;
          // System.out.println("LOGIT : Scan Result");
          // System.out.println("LOGIT MAC: " + macAddress);
          // System.out.println("LOGIT RSSI: " + rssi);
          // Check if a result with the same macAddress already exists
          boolean found = false;
          for (int i = 0; i < scanResults.size(); i++) {
              ScanResult existingResult = scanResults.get(i);
              String existingMacAddress = existingResult.getDevice().getAddress();
              if (macAddress.equals(existingMacAddress)) {
                  // Replace the existing result with the new one
                  scanResults.set(i, result);
                  found = true;
                  break;
              }
          }
          // If not found, add the result to the list
          if (!found) {
              scanResults.add(result);
          }
          if(scanResults.size() > 100)
            scanResults.remove(0);
          scanEvent(scanResults);
      }
  };

  bluetoothLeScanner.startScan(scanCallback);
}

public void stopScan(){
  if(scanCallback != null){
    bluetoothLeScanner.stopScan(scanCallback);
    scanCallback = null;
  }
}

public void printJava(String s, int i){
  System.out.println("LOGIT: " + s + " " + i);
}
